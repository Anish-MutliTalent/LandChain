const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/decimals-CnTmy4ui.js","assets/index-DPe3i_VP.js","assets/index-BkWRKyNb.css","assets/read-contract-CaWjiZj3.js","assets/signing-C5WNmJNj.js","assets/concat-hex-Cvyvp76r.js","assets/addresses-Cbjra2SQ.js","assets/send-eip712-transaction-CuNPfN8E.js","assets/eth_sendRawTransaction-DPdnXbFR.js","assets/random-BkU3W84C.js"])))=>i.map(i=>d[i]);
import{B as Ce,L as re,M as Ie,N as Fe,O as S,P as _e,Q as J,R as ie,S as oe,T as ce,U as Ne,V as ee,W as $e,X as de,Y as ue,Z as pe,$ as Ve,a0 as Be,a1 as H,a2 as Re,a3 as U,_ as k,a4 as He,a5 as me,a6 as ye,a7 as ke,a8 as Me,i as z,E as le,a9 as C,aa as L,ab as D,f as fe,ac as K,ad as x,a as he,s as F,ae as G,af as W,ag as Z,ah as _,ai as qe,aj as je,ak as ze,al as O,am as Ke,an as We,ao as Ze,ap as ge,aq as Ae,ar as Ye,as as Qe,at as Xe,au as Je,av as et,b as we,p as tt,e as I,t as N,aw as at,ax as nt}from"./index-DPe3i_VP.js";import{r as b}from"./read-contract-CaWjiZj3.js";import{Z as ve}from"./addresses-Cbjra2SQ.js";import{t as st,p as rt,s as it}from"./send-eip712-transaction-CuNPfN8E.js";import{r as ot}from"./random-BkU3W84C.js";class ct extends Ce{constructor(a){super(`Filter type "${a}" is not supported.`,{name:"FilterTypeNotSupportedError"})}}const B=re;function dt(e){const{abi:a,args:t=[],name:r}=e,o=Ie(r,{strict:!1}),n=a.filter(s=>o?s.type==="function"?Fe(s)===r:s.type==="event"?B(s)===r:!1:"name"in s&&s.name===r);if(n.length===0)return;if(n.length===1)return n[0];let i;for(const s of n){if(!("inputs"in s))continue;if(!t||t.length===0){if(!s.inputs||s.inputs.length===0)return s;continue}if(!s.inputs||s.inputs.length===0||s.inputs.length!==t.length)continue;if(t.every((d,p)=>{const m="inputs"in s&&s.inputs[p];return m?M(d,m):!1})){if(i&&"inputs"in i&&i.inputs){const d=Ge(s.inputs,i.inputs,t);if(d)throw new _e({abiItem:s,type:d[0]},{abiItem:i,type:d[1]})}i=s}}return i||n[0]}function M(e,a){const t=typeof e,r=a.type;switch(r){case"address":return S(e,{strict:!1});case"bool":return t==="boolean";case"function":return t==="string";case"string":return t==="string";default:return r==="tuple"&&"components"in a?Object.values(a.components).every((o,n)=>M(Object.values(e)[n],o)):/^u?int(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/.test(r)?t==="number"||t==="bigint":/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/.test(r)?t==="string"||e instanceof Uint8Array:/[a-z]+[1-9]{0,3}(\[[0-9]{0,}\])+$/.test(r)?Array.isArray(e)&&e.every(o=>M(o,{...a,type:r.replace(/(\[[0-9]{0,}\])$/,"")})):!1}}function Ge(e,a,t){for(const r in e){const o=e[r],n=a[r];if(o.type==="tuple"&&n.type==="tuple"&&"components"in o&&"components"in n)return Ge(o.components,n.components,t[r]);const i=[o.type,n.type];if(i.includes("address")&&i.includes("bytes20")?!0:i.includes("address")&&i.includes("string")?S(t[r],{strict:!1}):i.includes("address")&&i.includes("bytes")?S(t[r],{strict:!1}):!1)return i}}const te="/docs/contract/encodeEventTopics";function ut(e){var c;const{abi:a,eventName:t,args:r}=e;let o=a[0];if(t){const d=dt({abi:a,name:t});if(!d)throw new J(t,{docsPath:te});o=d}if(o.type!=="event")throw new J(void 0,{docsPath:te});const n=ie(o),i=B(n);let s=[];if(r&&"inputs"in o){const d=(c=o.inputs)==null?void 0:c.filter(m=>"indexed"in m&&m.indexed),p=Array.isArray(r)?r:Object.values(r).length>0?(d==null?void 0:d.map(m=>r[m.name]))??[]:[];p.length>0&&(s=(d==null?void 0:d.map((m,u)=>Array.isArray(p[u])?p[u].map((A,g)=>ae({param:m,value:p[u][g]})):typeof p[u]<"u"&&p[u]!==null?ae({param:m,value:p[u]}):null))??[])}return[i,...s]}function ae({param:e,value:a}){if(e.type==="string"||e.type==="bytes")return oe(ce(a));if(e.type==="tuple"||e.type.match(/^(.*)\[(\d+)?\]$/))throw new ct(e.type);return Ne([e],[a])}function pt(e,a){if(!S(e,{strict:!1}))throw new ee({address:e});if(!S(a,{strict:!1}))throw new ee({address:a});return e.toLowerCase()===a.toLowerCase()}const ne="/docs/contract/decodeEventLog";function mt(e){const{abi:a,data:t,strict:r,topics:o}=e,n=r??!0,[i,...s]=o;if(!i)throw new $e({docsPath:ne});const c=a.length===1?a[0]:a.find(l=>l.type==="event"&&i===B(ie(l)));if(!(c&&"name"in c)||c.type!=="event")throw new de(i,{docsPath:ne});const{name:d,inputs:p}=c,m=p==null?void 0:p.some(l=>!("name"in l&&l.name));let u=m?[]:{};const A=p.filter(l=>"indexed"in l&&l.indexed);for(let l=0;l<A.length;l++){const w=A[l],h=s[l];if(!h)throw new ue({abiItem:c,param:w});u[m?l:w.name||l]=yt({param:w,value:h})}const g=p.filter(l=>!("indexed"in l&&l.indexed));if(g.length>0){if(t&&t!=="0x")try{const l=pe(g,t);if(l)if(m)u=[...u,...l];else for(let w=0;w<g.length;w++)u[g[w].name]=l[w]}catch(l){if(n)throw l instanceof Ve||l instanceof Be?new H({abiItem:c,data:t,params:g,size:Re(t)}):l}else if(n)throw new H({abiItem:c,data:"0x",params:g,size:0})}return{eventName:d,args:Object.values(u).length>0?u:void 0}}function yt({param:e,value:a}){return e.type==="string"||e.type==="bytes"||e.type==="tuple"||e.type.match(/^(.*)\[(\d+)?\]$/)?a:(pe([e],a)||[])[0]}function lt(e){const{abi:a,args:t,logs:r,strict:o=!0}=e,n=(()=>{if(e.eventName)return Array.isArray(e.eventName)?e.eventName:[e.eventName]})();return r.map(i=>{var s;try{const c=a.find(p=>p.type==="event"&&i.topics[0]===B(p));if(!c)return null;const d=mt({...i,abi:[c],strict:o});return n&&!n.includes(d.eventName)||!ft({args:d.args,inputs:c.inputs,matchArgs:t})?null:{...d,...i}}catch(c){let d,p;if(c instanceof de)return null;if(c instanceof H||c instanceof ue){if(o)return null;d=c.abiItem.name,p=(s=c.abiItem.inputs)==null?void 0:s.some(m=>!("name"in m&&m.name))}return{...i,args:p?[]:{},eventName:d}}}).filter(Boolean)}function ft(e){const{args:a,inputs:t,matchArgs:r}=e;if(!r)return!0;if(!a)return!1;function o(n,i,s){try{return n.type==="address"?pt(i,s):n.type==="string"||n.type==="bytes"?oe(ce(i))===s:i===s}catch{return!1}}return Array.isArray(a)&&Array.isArray(r)?r.every((n,i)=>{if(n==null)return!0;const s=t[i];return s?(Array.isArray(n)?n:[n]).some(d=>o(s,d,a[i])):!1}):typeof a=="object"&&!Array.isArray(a)&&typeof r=="object"&&!Array.isArray(r)?Object.entries(r).every(([n,i])=>{if(i==null)return!0;const s=t.find(d=>d.name===n);return s?(Array.isArray(i)?i:[i]).some(d=>o(s,d,a[n])):!1}):!1}const ht="0xdd62ed3e",gt=[{type:"address",name:"owner"},{type:"address",name:"spender"}],At=[{type:"uint256"}];async function wt(e){return b({contract:e.contract,method:[ht,gt,At],params:[e.owner,e.spender]})}function Te(e){let a;return()=>(a||(a=e()),a)}const vt="0x095ea7b3",Gt=[{type:"address",name:"spender"},{type:"uint256",name:"value"}],Tt=[{type:"bool"}];function Pt(e){const a=Te(async()=>"asyncParams"in e?await e.asyncParams():e);return U({contract:e.contract,method:[vt,Gt,Tt],params:async()=>{const t=await a();return[t.spender,t.value]},value:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.value},accessList:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.accessList},gas:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.gas},gasPrice:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.gasPrice},maxFeePerGas:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.maxFeePerGas},maxPriorityFeePerGas:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.maxPriorityFeePerGas},nonce:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.nonce},extraGas:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.extraGas},erc20Value:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.erc20Value}})}function xt(e){return Pt({contract:e.contract,asyncParams:async()=>{let a;if("amount"in e){const{decimals:t}=await k(async()=>{const{decimals:o}=await import("./decimals-CnTmy4ui.js");return{decimals:o}},__vite__mapDeps([0,1,2,3])),r=await t(e).catch(()=>18);a=He(e.amount.toString(),r)}else a=e.amountWei;return{spender:e.spender,value:a,overrides:{erc20Value:{amountWei:a,tokenAddress:e.contract.address}}}}})}const Ot="0xf15d424e",bt=[{type:"address",name:"signer"}],Lt=[{type:"tuple",name:"permissions",components:[{type:"address",name:"signer"},{type:"address[]",name:"approvedTargets"},{type:"uint256",name:"nativeTokenLimitPerTransaction"},{type:"uint128",name:"startTimestamp"},{type:"uint128",name:"endTimestamp"}]}];async function Dt(e){return b({contract:e.contract,method:[Ot,bt,Lt],params:[e.signer]})}const Et="0x5892e236",St=[{type:"tuple",name:"req",components:[{type:"address",name:"signer"},{type:"uint8",name:"isAdmin"},{type:"address[]",name:"approvedTargets"},{type:"uint256",name:"nativeTokenLimitPerTransaction"},{type:"uint128",name:"permissionStartTimestamp"},{type:"uint128",name:"permissionEndTimestamp"},{type:"uint128",name:"reqValidityStartTimestamp"},{type:"uint128",name:"reqValidityEndTimestamp"},{type:"bytes32",name:"uid"}]},{type:"bytes",name:"signature"}],Ut=[];function Ct(e){const a=Te(async()=>"asyncParams"in e?await e.asyncParams():e);return U({contract:e.contract,method:[Et,St,Ut],params:async()=>{const t=await a();return[t.req,t.signature]},value:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.value},accessList:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.accessList},gas:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.gas},gasPrice:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.gasPrice},maxFeePerGas:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.maxFeePerGas},maxPriorityFeePerGas:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.maxPriorityFeePerGas},nonce:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.nonce},extraGas:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.extraGas},erc20Value:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.erc20Value}})}function se(){return new Date(Date.now()+1e3*60*60*24*365*10)}function R(e){return st(Math.floor(e.getTime()/1e3))}const It=[{name:"signer",type:"address"},{name:"isAdmin",type:"uint8"},{name:"approvedTargets",type:"address[]"},{name:"nativeTokenLimitPerTransaction",type:"uint256"},{name:"permissionStartTimestamp",type:"uint128"},{name:"permissionEndTimestamp",type:"uint128"},{name:"reqValidityStartTimestamp",type:"uint128"},{name:"reqValidityEndTimestamp",type:"uint128"},{name:"uid",type:"bytes32"}];async function Ft(e){const{account:a,contract:t,req:r}=e,o=await a.signTypedData({domain:{name:"Account",version:"1",verifyingContract:t.address,chainId:t.chain.id},primaryType:"SignerPermissionRequest",types:{SignerPermissionRequest:It},message:r});return{req:r,signature:o}}async function _t(e){var r;const{target:a,permissions:t}=e;return{approvedTargets:t.approvedTargets==="*"?[ve]:t.approvedTargets,nativeTokenLimitPerTransaction:me(((r=t.nativeTokenLimitPerTransaction)==null?void 0:r.toString())||"0"),permissionStartTimestamp:R(t.permissionStartTimestamp||new Date(0)),permissionEndTimestamp:R(t.permissionEndTimestamp||se()),reqValidityStartTimestamp:0n,reqValidityEndTimestamp:R(se()),uid:await ot(),isAdmin:0,signer:a}}function Nt(e){const{contract:a,sessionKeyAddress:t,account:r,permissions:o}=e;return Ct({contract:a,async asyncParams(){const{req:n,signature:i}=await Ft({account:r,contract:a,req:await _t({target:t,permissions:o})});return{signature:i,req:n}}})}async function $t(e){var i;const{accountContract:a,sessionKeyAddress:t,newPermissions:r}=e;if(!await ye(a))return!0;const n=await Dt({contract:a,signer:t});return!!(n.endTimestamp&&n.endTimestamp<Math.floor(new Date().getTime()/1e3)||!Vt(n.approvedTargets,r.approvedTargets)||me(((i=r.nativeTokenLimitPerTransaction)==null?void 0:i.toString())??"0")>n.nativeTokenLimitPerTransaction)}function Vt(e,a){return a==="*"&&e.length===1&&e[0]===ve?!0:a!=="*"?a.map(t=>t.toLowerCase()).every(t=>e.map(r=>r.toLowerCase()).includes(t)):!1}const Bt=2n**96n-1n;function Rt(e){const{logs:a,events:t,strict:r}=e;return lt({logs:a,abi:t.map(o=>o.abiEvent),strict:r})}function Ht(e){return!!(e&&typeof e=="object"&&"type"in e&&e.type==="event")}function Pe(e){const{signature:a}=e;let t;return Ht(a)?t=a:t=ke(a),{abiEvent:t,hash:re(t),topics:ut({abi:[t],args:e.filters})}}function kt(e={}){return Pe({signature:"event UserOperationRevertReason(bytes32 indexed userOpHash, address indexed sender, uint256 nonce, bytes revertReason)",filters:e})}function Mt(e={}){return Pe({signature:"event PostOpRevertReason(bytes32 indexed userOpHash, address indexed sender, uint256 nonce, bytes revertReason)",filters:e})}function qt(e){const{receipt:a}=e,t={...a,transactionHash:a.transactionHash,blockNumber:a.blockNumber?BigInt(a.blockNumber):null,contractAddress:a.contractAddress?a.contractAddress:null,cumulativeGasUsed:a.cumulativeGasUsed?BigInt(a.cumulativeGasUsed):null,effectiveGasPrice:a.effectiveGasPrice?BigInt(a.effectiveGasPrice):null,gasUsed:a.gasUsed?BigInt(a.gasUsed):null,logs:a.logs,to:a.to?a.to:null,transactionIndex:a.transactionIndex,status:a.status,type:a.type};return a.blobGasPrice&&(t.blobGasPrice=BigInt(a.blobGasPrice)),a.blobGasUsed&&(t.blobGasUsed=BigInt(a.blobGasUsed)),{...e,receipt:t,userOpHash:e.userOpHash,actualGasCost:BigInt(e.actualGasCost),actualGasUsed:BigInt(e.actualGasUsed),nonce:BigInt(e.nonce)}}async function jt(e){const{factoryContract:a,predictAddressOverride:t,adminAddress:r,accountSalt:o,accountAddress:n}=e;if(t)return t(a,r);if(n)return n;if(!r)throw new Error("Account address is required to predict the smart wallet address.");return Me(async()=>{const i=o&&z(o)?o:le(o??"");let s,c=0;const d=3;for(;c<=d;)try{s=await b({contract:a,method:"function getAddress(address, bytes) returns (address)",params:[r,i]});break}catch(p){if(c===d)throw p;const m=2**(c+1)*200;await new Promise(u=>setTimeout(u,m)),c++}if(!s)throw new Error(`No smart account address found for admin address ${r} and salt ${o}`);return s},{cacheKey:`${e.factoryContract.chain.id}-${e.factoryContract.address}-${e.adminAddress}-${e.accountSalt}`,cacheTime:1e3*60*60*24})}function xe(e){const{adminAddress:a,factoryContract:t,createAccountOverride:r,accountSalt:o}=e;if(r)return r(t,a);const n=o&&z(o)?o:le(o??"");return U({contract:t,method:"function createAccount(address, bytes) returns (address)",params:[a,n]})}function Oe(e){const{accountContract:a,transaction:t,executeOverride:r}=e;if(r)return r(a,t);let o=t.value||0n;return(t.chainId===295||t.chainId===296)&&(o=o/BigInt(10**10)),U({contract:a,method:"function execute(address, uint256, bytes)",params:[t.to||"",o,t.data||"0x"],gas:t.gas?t.gas+21000n:void 0})}function zt(e){var i;const{accountContract:a,transactions:t,executeBatchOverride:r}=e;if(r)return r(a,t);let o=t.map(s=>s.value||0n);const n=(i=t[0])==null?void 0:i.chainId;return(n===295||n===296)&&(o=o.map(s=>s/BigInt(10**10))),U({contract:a,method:"function executeBatch(address[], uint256[], bytes[])",params:[t.map(s=>s.to||""),o,t.map(s=>s.data||"0x")]})}const Kt="0x35567e1a",Wt=[{type:"address",name:"sender"},{type:"uint192",name:"key"}],Zt=[{type:"uint256",name:"nonce"}];async function Yt(e){return b({contract:e.contract,method:[Kt,Wt,Zt],params:[e.sender,e.key]})}const Qt="0xa6193531",Xt=[{type:"tuple",name:"userOp",components:[{type:"address",name:"sender"},{type:"uint256",name:"nonce"},{type:"bytes",name:"initCode"},{type:"bytes",name:"callData"},{type:"uint256",name:"callGasLimit"},{type:"uint256",name:"verificationGasLimit"},{type:"uint256",name:"preVerificationGas"},{type:"uint256",name:"maxFeePerGas"},{type:"uint256",name:"maxPriorityFeePerGas"},{type:"bytes",name:"paymasterAndData"},{type:"bytes",name:"signature"}]}],Jt=[{type:"bytes32"}];async function ea(e){return b({contract:e.contract,method:[Qt,Xt,Jt],params:[e.userOp]})}const ta="0x22cdde4c",aa=[{type:"tuple",name:"userOp",components:[{type:"address",name:"sender"},{type:"uint256",name:"nonce"},{type:"bytes",name:"initCode"},{type:"bytes",name:"callData"},{type:"bytes32",name:"accountGasLimits"},{type:"uint256",name:"preVerificationGas"},{type:"bytes32",name:"gasFees"},{type:"bytes",name:"paymasterAndData"},{type:"bytes",name:"signature"}]}],na=[{type:"bytes32"}];async function sa(e){return b({contract:e.contract,method:[ta,aa,na],params:[e.userOp]})}function ra(e){return e.factory?C([e.factory,e.factoryData||"0x"]):"0x"}function ia(e){return C([L(D(BigInt(e.verificationGasLimit)),{size:16}),L(D(BigInt(e.callGasLimit)),{size:16})])}function oa(e){return C([L(D(BigInt(e.maxPriorityFeePerGas)),{size:16}),L(D(BigInt(e.maxFeePerGas)),{size:16})])}function ca(e){return e.paymaster?C([e.paymaster,L(D(BigInt(e.paymasterVerificationGasLimit||0)),{size:16}),L(D(BigInt(e.paymasterPostOpGasLimit||0)),{size:16}),e.paymasterData||"0x"]):"0x"}const da=e=>({sender:e.sender,nonce:BigInt(e.nonce),initCode:ra(e),callData:e.callData,accountGasLimits:ia(e),preVerificationGas:BigInt(e.preVerificationGas),gasFees:oa(e),paymasterAndData:ca(e),signature:e.signature}),ua=()=>{const e=BigInt(Math.floor(Math.random()*4294967296)),a=BigInt(Math.floor(Math.random()*4294967296)),t=BigInt(Math.floor(Math.random()*4294967296)),r=BigInt(Math.floor(Math.random()*4294967296)),o=BigInt(Math.floor(Math.random()*4294967296)),n=BigInt(Math.floor(Math.random()*4294967296));return e<<BigInt(160)|a<<BigInt(128)|t<<BigInt(96)|r<<BigInt(64)|o<<BigInt(32)|n};function Y(e){return Object.fromEntries(Object.entries(e).map(([a,t])=>[a,t==null||z(t)?t:fe(t)]))}async function $(e){var g;const{userOp:a,paymasterOverride:t,client:r,chain:o,entrypointAddress:n}=e;if(t)return t(a);const i={"Content-Type":"application/json"},s=n??x,c=K(o),d={jsonrpc:"2.0",id:1,method:"pm_sponsorUserOperation",params:[Y(a),s]},m=await he(r)(c,{method:"POST",headers:i,body:F(d)});if(!m.ok){const l=await m.text()||m.statusText;throw new Error(`Paymaster error: ${m.status} - ${l}`)}const u=await m.json();if(u.result)return typeof u.result=="string"?{paymasterAndData:u.result}:(u.result.policyId&&u.result.reason&&console.warn(`Paymaster policy rejected this transaction with reason: ${u.result.reason} (policyId: ${u.result.policyId})`),{paymasterAndData:u.result.paymasterAndData,verificationGasLimit:u.result.verificationGasLimit?G(u.result.verificationGasLimit):void 0,preVerificationGas:u.result.preVerificationGas?G(u.result.preVerificationGas):void 0,callGasLimit:u.result.callGasLimit?G(u.result.callGasLimit):void 0,paymaster:u.result.paymaster,paymasterData:u.result.paymasterData,paymasterVerificationGasLimit:u.result.paymasterVerificationGasLimit?G(u.result.paymasterVerificationGasLimit):void 0,paymasterPostOpGasLimit:u.result.paymasterPostOpGasLimit?G(u.result.paymasterPostOpGasLimit):void 0});const A=((g=u.error)==null?void 0:g.message)||u.error||m.statusText||"unknown error";throw new Error(`Paymaster error from ${c}: ${A}`)}const Q=new Set,X=e=>`${e.chain.id}:${e.address}`,be=e=>{Q.add(X(e))},Le=e=>{Q.delete(X(e))},De=e=>Q.has(X(e));async function pa(e){const a=e.timeoutMs||12e4,t=e.intervalMs||1e3,r=Date.now()+a;for(;Date.now()<r;){const o=await Ta(e);if(o)return o;await new Promise(n=>setTimeout(n,t))}throw new Error(`Timeout waiting for userOp to be mined on chain ${e.chain.id} with UserOp hash: ${e.userOpHash}`)}async function ma(e){var v;const{transaction:a,accountContract:t,factoryContract:r,adminAddress:o,overrides:n,sponsorGas:i,waitForDeployment:s=!0,isDeployedOverride:c}=e,d=a.chain,p=a.client,m={client:p,chain:d,bundlerUrl:n==null?void 0:n.bundlerUrl,entrypointAddress:n==null?void 0:n.entrypointAddress},u=W(((v=e.overrides)==null?void 0:v.entrypointAddress)||x),[A,g,l,w,h]=await Promise.all([typeof c=="boolean"?c:ye(t).then(T=>T||De(t)),Z(a),_(a.gas),ya({executeTx:a,bundlerOptions:m,chain:d,client:p}),wa({accountContract:t,chain:d,client:p,entrypointAddress:n==null?void 0:n.entrypointAddress,getNonceOverride:n==null?void 0:n.getAccountNonce})]),{maxFeePerGas:y,maxPriorityFeePerGas:f}=w;return u==="v0.7"?la({bundlerOptions:m,factoryContract:r,accountContract:t,adminAddress:o,sponsorGas:i,overrides:n,isDeployed:A,nonce:h,callData:g,callGasLimit:l,maxFeePerGas:y,maxPriorityFeePerGas:f,waitForDeployment:s}):fa({bundlerOptions:m,factoryContract:r,accountContract:t,adminAddress:o,sponsorGas:i,overrides:n,isDeployed:A,nonce:h,callData:g,callGasLimit:l,maxFeePerGas:y,maxPriorityFeePerGas:f,waitForDeployment:s})}async function ya(e){const{executeTx:a,bundlerOptions:t,chain:r,client:o}=e;let{maxFeePerGas:n,maxPriorityFeePerGas:i}=a;const s=(t==null?void 0:t.bundlerUrl)??K(r);if(je(s)){const c=await Ga({options:t});n=c.maxFeePerGas,i=c.maxPriorityFeePerGas}else{const[c,d]=await Promise.all([_(n),_(i)]);if(c&&d)n=c,i=d;else{const p=await ze(o,r);i=d??p.maxPriorityFeePerGas??0n,n=c??p.maxFeePerGas??0n}}return{maxFeePerGas:n,maxPriorityFeePerGas:i}}async function la(e){const{bundlerOptions:a,isDeployed:t,factoryContract:r,accountContract:o,adminAddress:n,sponsorGas:i,overrides:s,nonce:c,callData:d,callGasLimit:p,maxFeePerGas:m,maxPriorityFeePerGas:u,waitForDeployment:A}=e,{chain:g,client:l}=a;let w,h;t?(h="0x",A&&await Ee(o)):(w=r.address,h=await Z(xe({factoryContract:r,adminAddress:n,accountSalt:s==null?void 0:s.accountSalt,createAccountOverride:s==null?void 0:s.createAccount})),A&&be(o));const y={sender:o.address,nonce:c,callData:d,maxFeePerGas:m,maxPriorityFeePerGas:u,callGasLimit:p??0n,verificationGasLimit:0n,preVerificationGas:0n,factory:w,factoryData:h,paymaster:void 0,paymasterData:"0x",paymasterVerificationGasLimit:0n,paymasterPostOpGasLimit:0n,signature:ge};if(i){const f=await $({userOp:y,chain:g,client:l,entrypointAddress:s==null?void 0:s.entrypointAddress,paymasterOverride:s==null?void 0:s.paymaster});if(f.paymaster&&f.paymasterData&&(y.paymaster=f.paymaster,y.paymasterData=f.paymasterData),f.callGasLimit&&f.verificationGasLimit&&f.preVerificationGas&&f.paymasterPostOpGasLimit&&f.paymasterVerificationGasLimit)y.callGasLimit=f.callGasLimit,y.verificationGasLimit=f.verificationGasLimit,y.preVerificationGas=f.preVerificationGas,y.paymasterPostOpGasLimit=f.paymasterPostOpGasLimit,y.paymasterVerificationGasLimit=f.paymasterVerificationGasLimit;else{const v=s!=null&&s.tokenPaymaster?{[s.tokenPaymaster.tokenAddress]:{stateDiff:{[Ke(We([{type:"address"},{type:"uint256"}],[o.address,s.tokenPaymaster.balanceStorageSlot]))]:fe(Ze,{size:32})}}}:void 0,T=await V({userOp:y,options:a},v);y.callGasLimit=T.callGasLimit,y.verificationGasLimit=T.verificationGasLimit,y.preVerificationGas=T.preVerificationGas,y.paymasterPostOpGasLimit=s!=null&&s.tokenPaymaster?500000n:T.paymasterPostOpGasLimit||0n,y.paymasterVerificationGasLimit=T.paymasterVerificationGasLimit||0n;const P=await $({userOp:y,chain:g,client:l,entrypointAddress:s==null?void 0:s.entrypointAddress,paymasterOverride:s==null?void 0:s.paymaster});P.paymaster&&P.paymasterData&&(y.paymaster=P.paymaster,y.paymasterData=P.paymasterData)}}else{const f=await V({userOp:y,options:a});y.callGasLimit=f.callGasLimit,y.verificationGasLimit=f.verificationGasLimit,y.preVerificationGas=f.preVerificationGas,y.paymasterPostOpGasLimit=f.paymasterPostOpGasLimit||0n,y.paymasterVerificationGasLimit=f.paymasterVerificationGasLimit||0n}return{...y,signature:"0x"}}async function fa(e){const{bundlerOptions:a,isDeployed:t,factoryContract:r,accountContract:o,adminAddress:n,sponsorGas:i,overrides:s,nonce:c,callData:d,callGasLimit:p,maxFeePerGas:m,maxPriorityFeePerGas:u,waitForDeployment:A}=e,{chain:g,client:l}=a;let w;t?(w="0x",A&&await Ee(o)):(w=await Aa({factoryContract:r,adminAddress:n,accountSalt:s==null?void 0:s.accountSalt,createAccountOverride:s==null?void 0:s.createAccount}),A&&be(o));const h={sender:o.address,nonce:c,initCode:w,callData:d,maxFeePerGas:m,maxPriorityFeePerGas:u,callGasLimit:p??0n,verificationGasLimit:0n,preVerificationGas:0n,paymasterAndData:"0x",signature:ge};if(i){const y=await $({userOp:h,chain:g,client:l,entrypointAddress:s==null?void 0:s.entrypointAddress,paymasterOverride:s==null?void 0:s.paymaster}),f="paymasterAndData"in y?y.paymasterAndData:"0x";if(f&&f!=="0x"&&(h.paymasterAndData=f),y.callGasLimit&&y.verificationGasLimit&&y.preVerificationGas)h.callGasLimit=y.callGasLimit,h.verificationGasLimit=y.verificationGasLimit,h.preVerificationGas=y.preVerificationGas;else{const v=await V({userOp:h,options:a});if(h.callGasLimit=v.callGasLimit,h.verificationGasLimit=v.verificationGasLimit,h.preVerificationGas=v.preVerificationGas,f&&f!=="0x"){const T=await $({userOp:h,chain:g,client:l,entrypointAddress:s==null?void 0:s.entrypointAddress,paymasterOverride:s==null?void 0:s.paymaster}),P="paymasterAndData"in T?T.paymasterAndData:"0x";P&&P!=="0x"&&(h.paymasterAndData=P)}}}else{const y=await V({userOp:h,options:a});h.callGasLimit=y.callGasLimit,h.verificationGasLimit=y.verificationGasLimit,h.preVerificationGas=y.preVerificationGas}return{...h,signature:"0x"}}async function ha(e){const{userOp:a,chain:t,entrypointAddress:r,adminAccount:o}=e,n=await ga({client:e.client,userOp:a,chain:t,entrypointAddress:r});if(o.signMessage){const i=await o.signMessage({message:{raw:qe(n)},originalMessage:F(a),chainId:t.id});return{...a,signature:i}}throw new Error("signMessage not implemented in signingAccount")}async function ga(e){const{userOp:a,chain:t,entrypointAddress:r}=e,o=W(r||x);let n;if(o==="v0.7"){const i=da(a);n=await sa({contract:O({address:r||Ae,chain:t,client:e.client}),userOp:i})}else n=await ea({contract:O({address:r||x,chain:t,client:e.client}),userOp:a});return n}async function Aa(e){const{factoryContract:a,adminAddress:t,accountSalt:r,createAccountOverride:o}=e,n=xe({factoryContract:a,adminAddress:t,accountSalt:r,createAccountOverride:o});return C([a.address,await Z(n)])}async function wa(e){const{accountContract:a,chain:t,client:r,entrypointAddress:o,getNonceOverride:n}=e;return n?n(a):await Yt({contract:O({address:o||x,chain:t,client:r}),key:ua(),sender:a.address})}async function Ee(e){const a=Date.now();for(;De(e);){if(Date.now()-a>6e4)throw Le(e),new Error("Account deployment is taking too long (over 1 minute). Please try again.");await new Promise(t=>setTimeout(t,500))}}async function va(e){return E({...e,operation:"eth_sendUserOperation",params:[Y(e.userOp),e.options.entrypointAddress??x]})}async function V(e,a){const t=await E({...e,operation:"eth_estimateUserOperationGas",params:[Y(e.userOp),e.options.entrypointAddress??x,a??{}]});return{preVerificationGas:G(t.preVerificationGas),verificationGas:t.verificationGas!==void 0?G(t.verificationGas):void 0,verificationGasLimit:G(t.verificationGasLimit),callGasLimit:G(t.callGasLimit)+Qe,paymasterVerificationGasLimit:t.paymasterVerificationGasLimit!==void 0?G(t.paymasterVerificationGasLimit):void 0,paymasterPostOpGasLimit:t.paymasterPostOpGasLimit!==void 0?G(t.paymasterPostOpGasLimit):void 0}}async function Ga(e){const a=await E({...e,operation:"thirdweb_getUserOperationGasPrice",params:[]});return{maxPriorityFeePerGas:G(a.maxPriorityFeePerGas),maxFeePerGas:G(a.maxFeePerGas)}}async function Ta(e){var t,r;const a=await Pa(e);if(a){if(a.success===!1){const n=(r=(t=Rt({events:[kt(),Mt()],logs:a.logs})[0])==null?void 0:t.args)==null?void 0:r.revertReason;if(!n)throw new Error(`UserOp failed at txHash: ${a.receipt.transactionHash}`);const i=Ye({data:n});throw new Error(`UserOp failed with reason: '${i.args.join(",")}' at txHash: ${a.receipt.transactionHash}`)}return a.receipt}}async function Pa(e){const a=await E({options:e,operation:"eth_getUserOperationReceipt",params:[e.userOpHash]});if(a)return qt(a)}async function xa(e){const a=await E({options:e.options,operation:"zk_paymasterData",params:[e.transaction]});return{paymaster:a.paymaster,paymasterInput:a.paymasterInput}}async function Oa(e){return{transactionHash:(await E({options:e.options,operation:"zk_broadcastTransaction",params:[{...e.transaction,signedTransaction:e.signedTransaction}]})).transactionHash}}async function E(e){const{options:a,operation:t,params:r}=e,o=a.bundlerUrl??K(a.chain),i=await he(a.client)(o,{method:"POST",headers:{"Content-Type":"application/json"},body:F({jsonrpc:"2.0",id:1,method:t,params:r})}),s=await i.json();if(!i.ok||s.error){let c=s.error||i.statusText;typeof c=="object"&&(c=F(c));const d=s.code||"UNKNOWN";throw new Error(`${t} error: ${c}
Status: ${i.status}
Code: ${d}`)}return s.result}const Se=new WeakMap,q=new WeakMap;async function ba(e,a){var A,g,l,w,h,y,f;const{personalAccount:t,client:r,chain:o}=e;if(!t)throw new Error("No personal account provided for smart account connection");const n=a,i=o??n.chain,s="gasless"in n?n.gasless:n.sponsorGas;if(await Xe(i))return[Sa({creationOptions:a,connectionOptions:e,chain:i,sponsorGas:s}),i];if(n.factoryAddress&&!((A=n.overrides)!=null&&A.entrypointAddress)){const v=await Ue(n.factoryAddress,r,i);v&&(n.overrides={...n.overrides,entrypointAddress:v})}(g=n.overrides)!=null&&g.tokenPaymaster&&!((l=n.overrides)!=null&&l.entrypointAddress)&&(n.overrides={...n.overrides,entrypointAddress:Ae});const c=n.factoryAddress??Je((w=n.overrides)==null?void 0:w.entrypointAddress),d=O({client:r,address:c,chain:i}),p=await jt({factoryContract:d,adminAddress:t.address,predictAddressOverride:(h=n.overrides)==null?void 0:h.predictAddress,accountSalt:(y=n.overrides)==null?void 0:y.accountSalt,accountAddress:(f=n.overrides)==null?void 0:f.accountAddress}).then(v=>v).catch(v=>{throw new Error(`Failed to get account address with factory contract ${d.address} on chain ID ${i.id}: ${(v==null?void 0:v.message)||"unknown error"}`,{cause:v})}),m=O({client:r,address:p,chain:i}),u=await Da({...n,chain:i,sponsorGas:s,personalAccount:t,accountContract:m,factoryContract:d,client:r});if(Se.set(t,u),q.set(u,t),n.sessionKey&&await $t({accountContract:m,sessionKeyAddress:n.sessionKey.address,newPermissions:n.sessionKey.permissions})){const v=Nt({account:t,contract:m,permissions:n.sessionKey.permissions,sessionKeyAddress:n.sessionKey.address});await et({account:u,transaction:v})}return[u,i]}async function La(e){const a=q.get(e);a&&(Se.delete(a),q.delete(e))}async function Da(e){var o,n;const a=(o=e.overrides)==null?void 0:o.tokenPaymaster;if(a&&W(((n=e.overrides)==null?void 0:n.entrypointAddress)||x)!=="v0.7")throw new Error("Token paymaster is only supported for entrypoint version v0.7");let t=e.accountContract;const r={address:we(t.address),async sendTransaction(i){var m,u,A;let s;if(a){await Ea({accountContract:t,erc20Paymaster:a,options:e});const g=async()=>({paymaster:a.paymasterAddress,paymasterData:"0x"});s=((m=e.overrides)==null?void 0:m.paymaster)||g}else s=(u=e.overrides)==null?void 0:u.paymaster;i.chainId!==t.chain.id&&(t=O({address:r.address,chain:I(i.chainId),client:e.client}));const c=Oe({accountContract:t,transaction:i,executeOverride:(A=e.overrides)==null?void 0:A.execute}),d=I(i.chainId),p=await j({executeTx:c,options:{...e,chain:d,accountContract:t,overrides:{...e.overrides,paymaster:s}}});return N({client:e.client,chainId:d.id,transactionHash:p.transactionHash,walletAddress:e.accountContract.address,walletType:"smart",contractAddress:i.to??void 0}),p},async sendBatchTransaction(i){var m,u;const s=zt({accountContract:t,transactions:i,executeBatchOverride:(m=e.overrides)==null?void 0:m.executeBatch});if(i.length===0)throw new Error("No transactions to send");const c=i[0];if(!c)throw new Error("No transactions to send");const d=I(c.chainId),p=await j({executeTx:s,options:{...e,chain:d,accountContract:t}});return N({client:e.client,chainId:d.id,transactionHash:p.transactionHash,walletAddress:e.accountContract.address,walletType:"smart",contractAddress:((u=i[0])==null?void 0:u.to)??void 0}),p},async signMessage({message:i}){var c;if((c=e.overrides)!=null&&c.signMessage)return e.overrides.signMessage({adminAccount:e.personalAccount,factoryContract:e.factoryContract,accountContract:t,message:i});const{smartAccountSignMessage:s}=await k(async()=>{const{smartAccountSignMessage:d}=await import("./signing-C5WNmJNj.js");return{smartAccountSignMessage:d}},__vite__mapDeps([4,1,2,5,3,6,7,8,9]));return s({accountContract:t,factoryContract:e.factoryContract,options:e,message:i})},async signTypedData(i){var c;if((c=e.overrides)!=null&&c.signTypedData)return e.overrides.signTypedData({adminAccount:e.personalAccount,factoryContract:e.factoryContract,accountContract:t,typedData:i});const{smartAccountSignTypedData:s}=await k(async()=>{const{smartAccountSignTypedData:d}=await import("./signing-C5WNmJNj.js");return{smartAccountSignTypedData:d}},__vite__mapDeps([4,1,2,5,3,6,7,8,9]));return s({accountContract:t,factoryContract:e.factoryContract,options:e,typedData:i})},async onTransactionRequested(i){var s,c;return(c=(s=e.personalAccount).onTransactionRequested)==null?void 0:c.call(s,i)}};return r}async function Ea(e){var p;const{accountContract:a,erc20Paymaster:t,options:r}=e,o=t.tokenAddress,n=O({address:o,chain:a.chain,client:a.client});if(await wt({contract:n,owner:a.address,spender:t.paymasterAddress})>0n)return;const s=xt({contract:n,spender:t.paymasterAddress,amountWei:Bt-1n}),c=await at({transaction:s,from:a.address}),d=Oe({accountContract:a,transaction:c,executeOverride:(p=r.overrides)==null?void 0:p.execute});await j({executeTx:d,options:{...r,overrides:{...r.overrides,tokenPaymaster:void 0}}})}function Sa(e){const{creationOptions:a,connectionOptions:t,chain:r}=e,o={address:we(t.personalAccount.address),async sendTransaction(n){var p,m,u,A;const i={data:n.data,to:n.to??void 0,value:n.value??0n,chain:I(n.chainId),client:t.client,eip712:n.eip712};let s=await rt({account:o,transaction:i});if(e.sponsorGas&&!s.paymaster){const g=await xa({options:{client:t.client,chain:r,bundlerUrl:(p=a.overrides)==null?void 0:p.bundlerUrl,entrypointAddress:(m=a.overrides)==null?void 0:m.entrypointAddress},transaction:s});s={...s,...g}}const c=await it({account:o,chainId:r.id,eip712Transaction:s}),d=await Oa({options:{client:t.client,chain:r,bundlerUrl:(u=a.overrides)==null?void 0:u.bundlerUrl,entrypointAddress:(A=a.overrides)==null?void 0:A.entrypointAddress},transaction:s,signedTransaction:c});return N({client:t.client,chainId:r.id,transactionHash:d.transactionHash,walletAddress:o.address,walletType:"smart",contractAddress:n.to??void 0}),{transactionHash:d.transactionHash,client:t.client,chain:r}},async signMessage({message:n}){return t.personalAccount.signMessage({message:n})},async signTypedData(n){const i=tt(n);return t.personalAccount.signTypedData(i)},async onTransactionRequested(n){var i,s;return(s=(i=t.personalAccount).onTransactionRequested)==null?void 0:s.call(i,n)}};return o}async function j(e){var r,o,n;const{executeTx:a,options:t}=e;try{const i=await ma({transaction:a,factoryContract:t.factoryContract,accountContract:t.accountContract,adminAddress:t.personalAccount.address,sponsorGas:t.sponsorGas,overrides:t.overrides}),s=await ha({client:t.client,chain:t.chain,adminAccount:t.personalAccount,entrypointAddress:(r=t.overrides)==null?void 0:r.entrypointAddress,userOp:i}),c={chain:t.chain,client:t.client,bundlerUrl:(o=t.overrides)==null?void 0:o.bundlerUrl,entrypointAddress:(n=t.overrides)==null?void 0:n.entrypointAddress},d=await va({options:c,userOp:s}),p=await pa({...c,userOpHash:d});return N({client:t.client,chainId:t.chain.id,transactionHash:p.transactionHash,walletAddress:t.accountContract.address,walletType:"smart",contractAddress:await _(a.to??void 0)}),{client:t.client,chain:t.chain,transactionHash:p.transactionHash}}finally{Le(t.accountContract)}}async function Ue(e,a,t){const r=O({address:e,client:a,chain:t});try{return await b({contract:r,method:"function entrypoint() public view returns (address)"})}catch{return}}const Na=Object.freeze(Object.defineProperty({__proto__:null,connectSmartAccount:ba,disconnectSmartAccount:La,getEntrypointFromFactory:Ue,isSmartWallet:nt},Symbol.toStringTag,{value:"Module"}));export{Na as i,xe as p};
