import{an as E,aR as _,aS as I,aT as be,aU as V,aV as me,aW as ge,aJ as H,aX as L,F as he,aY as we,aZ as ve,a_ as $e,a$ as Se,i as xe,b0 as Ae,a6 as z,al as M,at as Ee,d as Me,b1 as Te,b2 as Z,b3 as Pe,am as h,b4 as N,b5 as Ie,b6 as ke,b7 as _e,b8 as Oe,f as K,ag as W}from"./index-DPe3i_VP.js";import{concatHex as Re}from"./concat-hex-Cvyvp76r.js";import{r as O,e as De}from"./read-contract-CaWjiZj3.js";import{p as G}from"./index-CXzdPHn2.js";import"./addresses-Cbjra2SQ.js";import"./send-eip712-transaction-CuNPfN8E.js";import"./eth_sendRawTransaction-DPdnXbFR.js";import"./random-BkU3W84C.js";const je="1.0.8";class b extends Error{constructor(t,n={}){var s;const r=n.cause instanceof b?n.cause.details:(s=n.cause)!=null&&s.message?n.cause.message:n.details,a=n.cause instanceof b&&n.cause.docsPath||n.docsPath,i=[t||"An error occurred.","",...n.metaMessages?[...n.metaMessages,""]:[],...a?[`Docs: https://abitype.dev${a}`]:[],...r?[`Details: ${r}`]:[],`Version: abitype@${je}`].join(`
`);super(i),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiTypeError"}),n.cause&&(this.cause=n.cause),this.details=r,this.docsPath=a,this.metaMessages=n.metaMessages,this.shortMessage=t}}function g(e,t){const n=e.exec(t);return n==null?void 0:n.groups}const J=/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/,Y=/^u?int(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/,q=/^\(.+?\).*?$/,C=/^tuple(?<array>(\[(\d*)\])*)$/;function R(e){let t=e.type;if(C.test(e.type)&&"components"in e){t="(";const n=e.components.length;for(let a=0;a<n;a++){const i=e.components[a];t+=R(i),a<n-1&&(t+=", ")}const r=g(C,e.type);return t+=`)${(r==null?void 0:r.array)??""}`,R({...e,type:t})}return"indexed"in e&&e.indexed&&(t=`${t} indexed`),e.name?`${t} ${e.name}`:t}function x(e){let t="";const n=e.length;for(let r=0;r<n;r++){const a=e[r];t+=R(a),r!==n-1&&(t+=", ")}return t}function D(e){var t;return e.type==="function"?`function ${e.name}(${x(e.inputs)})${e.stateMutability&&e.stateMutability!=="nonpayable"?` ${e.stateMutability}`:""}${(t=e.outputs)!=null&&t.length?` returns (${x(e.outputs)})`:""}`:e.type==="event"?`event ${e.name}(${x(e.inputs)})`:e.type==="error"?`error ${e.name}(${x(e.inputs)})`:e.type==="constructor"?`constructor(${x(e.inputs)})${e.stateMutability==="payable"?" payable":""}`:e.type==="fallback"?`fallback() external${e.stateMutability==="payable"?" payable":""}`:"receive() external payable"}const X=/^error (?<name>[a-zA-Z$_][a-zA-Z0-9$_]*)\((?<parameters>.*?)\)$/;function Be(e){return X.test(e)}function Ue(e){return g(X,e)}const Q=/^event (?<name>[a-zA-Z$_][a-zA-Z0-9$_]*)\((?<parameters>.*?)\)$/;function Ve(e){return Q.test(e)}function ze(e){return g(Q,e)}const ee=/^function (?<name>[a-zA-Z$_][a-zA-Z0-9$_]*)\((?<parameters>.*?)\)(?: (?<scope>external|public{1}))?(?: (?<stateMutability>pure|view|nonpayable|payable{1}))?(?: returns\s?\((?<returns>.*?)\))?$/;function Fe(e){return ee.test(e)}function Ze(e){return g(ee,e)}const te=/^struct (?<name>[a-zA-Z$_][a-zA-Z0-9$_]*) \{(?<properties>.*?)\}$/;function ne(e){return te.test(e)}function Ce(e){return g(te,e)}const re=/^constructor\((?<parameters>.*?)\)(?:\s(?<stateMutability>payable{1}))?$/;function He(e){return re.test(e)}function Le(e){return g(re,e)}const ae=/^fallback\(\) external(?:\s(?<stateMutability>payable{1}))?$/;function Ne(e){return ae.test(e)}function Ke(e){return g(ae,e)}const We=/^receive\(\) external payable$/;function Ge(e){return We.test(e)}const Je=new Set(["indexed"]),j=new Set(["calldata","memory","storage"]);class Ye extends b{constructor({type:t}){super("Unknown type.",{metaMessages:[`Type "${t}" is not a valid ABI type. Perhaps you forgot to include a struct signature?`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"UnknownTypeError"})}}class qe extends b{constructor({type:t}){super("Unknown type.",{metaMessages:[`Type "${t}" is not a valid ABI type.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"UnknownSolidityTypeError"})}}class Xe extends b{constructor({param:t}){super("Invalid ABI parameter.",{details:t}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"InvalidParameterError"})}}class Qe extends b{constructor({param:t,name:n}){super("Invalid ABI parameter.",{details:t,metaMessages:[`"${n}" is a protected Solidity keyword. More info: https://docs.soliditylang.org/en/latest/cheatsheet.html`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"SolidityProtectedKeywordError"})}}class et extends b{constructor({param:t,type:n,modifier:r}){super("Invalid ABI parameter.",{details:t,metaMessages:[`Modifier "${r}" not allowed${n?` in "${n}" type`:""}.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"InvalidModifierError"})}}class tt extends b{constructor({param:t,type:n,modifier:r}){super("Invalid ABI parameter.",{details:t,metaMessages:[`Modifier "${r}" not allowed${n?` in "${n}" type`:""}.`,`Data location can only be specified for array, struct, or mapping types, but "${r}" was given.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"InvalidFunctionModifierError"})}}class nt extends b{constructor({abiParameter:t}){super("Invalid ABI parameter.",{details:JSON.stringify(t,null,2),metaMessages:["ABI parameter type is invalid."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"InvalidAbiTypeParameterError"})}}class $ extends b{constructor({signature:t,type:n}){super(`Invalid ${n} signature.`,{details:t}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"InvalidSignatureError"})}}class rt extends b{constructor({signature:t}){super("Unknown signature.",{details:t}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"UnknownSignatureError"})}}class at extends b{constructor({signature:t}){super("Invalid struct signature.",{details:t,metaMessages:["No properties exist."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"InvalidStructSignatureError"})}}class st extends b{constructor({type:t}){super("Circular reference detected.",{metaMessages:[`Struct "${t}" is a circular reference.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"CircularReferenceError"})}}class it extends b{constructor({current:t,depth:n}){super("Unbalanced parentheses.",{metaMessages:[`"${t.trim()}" has too many ${n>0?"opening":"closing"} parentheses.`],details:`Depth "${n}"`}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"InvalidParenthesisError"})}}function ot(e,t,n){let r="";if(n)for(const a of Object.entries(n)){if(!a)continue;let i="";for(const s of a[1])i+=`[${s.type}${s.name?`:${s.name}`:""}]`;r+=`(${a[0]}{${i}})`}return t?`${t}:${e}${r}`:e}const k=new Map([["address",{type:"address"}],["bool",{type:"bool"}],["bytes",{type:"bytes"}],["bytes32",{type:"bytes32"}],["int",{type:"int256"}],["int256",{type:"int256"}],["string",{type:"string"}],["uint",{type:"uint256"}],["uint8",{type:"uint8"}],["uint16",{type:"uint16"}],["uint24",{type:"uint24"}],["uint32",{type:"uint32"}],["uint64",{type:"uint64"}],["uint96",{type:"uint96"}],["uint112",{type:"uint112"}],["uint160",{type:"uint160"}],["uint192",{type:"uint192"}],["uint256",{type:"uint256"}],["address owner",{type:"address",name:"owner"}],["address to",{type:"address",name:"to"}],["bool approved",{type:"bool",name:"approved"}],["bytes _data",{type:"bytes",name:"_data"}],["bytes data",{type:"bytes",name:"data"}],["bytes signature",{type:"bytes",name:"signature"}],["bytes32 hash",{type:"bytes32",name:"hash"}],["bytes32 r",{type:"bytes32",name:"r"}],["bytes32 root",{type:"bytes32",name:"root"}],["bytes32 s",{type:"bytes32",name:"s"}],["string name",{type:"string",name:"name"}],["string symbol",{type:"string",name:"symbol"}],["string tokenURI",{type:"string",name:"tokenURI"}],["uint tokenId",{type:"uint256",name:"tokenId"}],["uint8 v",{type:"uint8",name:"v"}],["uint256 balance",{type:"uint256",name:"balance"}],["uint256 tokenId",{type:"uint256",name:"tokenId"}],["uint256 value",{type:"uint256",name:"value"}],["event:address indexed from",{type:"address",name:"from",indexed:!0}],["event:address indexed to",{type:"address",name:"to",indexed:!0}],["event:uint indexed tokenId",{type:"uint256",name:"tokenId",indexed:!0}],["event:uint256 indexed tokenId",{type:"uint256",name:"tokenId",indexed:!0}]]);function ut(e,t={}){if(Fe(e))return ct(e,t);if(Ve(e))return lt(e,t);if(Be(e))return ft(e,t);if(He(e))return dt(e,t);if(Ne(e))return pt(e);if(Ge(e))return{type:"receive",stateMutability:"payable"};throw new rt({signature:e})}function ct(e,t={}){const n=Ze(e);if(!n)throw new $({signature:e,type:"function"});const r=m(n.parameters),a=[],i=r.length;for(let o=0;o<i;o++)a.push(w(r[o],{modifiers:j,structs:t,type:"function"}));const s=[];if(n.returns){const o=m(n.returns),c=o.length;for(let u=0;u<c;u++)s.push(w(o[u],{modifiers:j,structs:t,type:"function"}))}return{name:n.name,type:"function",stateMutability:n.stateMutability??"nonpayable",inputs:a,outputs:s}}function lt(e,t={}){const n=ze(e);if(!n)throw new $({signature:e,type:"event"});const r=m(n.parameters),a=[],i=r.length;for(let s=0;s<i;s++)a.push(w(r[s],{modifiers:Je,structs:t,type:"event"}));return{name:n.name,type:"event",inputs:a}}function ft(e,t={}){const n=Ue(e);if(!n)throw new $({signature:e,type:"error"});const r=m(n.parameters),a=[],i=r.length;for(let s=0;s<i;s++)a.push(w(r[s],{structs:t,type:"error"}));return{name:n.name,type:"error",inputs:a}}function dt(e,t={}){const n=Le(e);if(!n)throw new $({signature:e,type:"constructor"});const r=m(n.parameters),a=[],i=r.length;for(let s=0;s<i;s++)a.push(w(r[s],{structs:t,type:"constructor"}));return{type:"constructor",stateMutability:n.stateMutability??"nonpayable",inputs:a}}function pt(e){const t=Ke(e);if(!t)throw new $({signature:e,type:"fallback"});return{type:"fallback",stateMutability:t.stateMutability??"nonpayable"}}const yt=/^(?<type>[a-zA-Z$_][a-zA-Z0-9$_]*)(?<array>(?:\[\d*?\])+?)?(?:\s(?<modifier>calldata|indexed|memory|storage{1}))?(?:\s(?<name>[a-zA-Z$_][a-zA-Z0-9$_]*))?$/,bt=/^\((?<type>.+?)\)(?<array>(?:\[\d*?\])+?)?(?:\s(?<modifier>calldata|indexed|memory|storage{1}))?(?:\s(?<name>[a-zA-Z$_][a-zA-Z0-9$_]*))?$/,mt=/^u?int$/;function w(e,t){var f,d;const n=ot(e,t==null?void 0:t.type,t==null?void 0:t.structs);if(k.has(n))return k.get(n);const r=q.test(e),a=g(r?bt:yt,e);if(!a)throw new Xe({param:e});if(a.name&&ht(a.name))throw new Qe({param:e,name:a.name});const i=a.name?{name:a.name}:{},s=a.modifier==="indexed"?{indexed:!0}:{},o=(t==null?void 0:t.structs)??{};let c,u={};if(r){c="tuple";const p=m(a.type),y=[],S=p.length;for(let v=0;v<S;v++)y.push(w(p[v],{structs:o}));u={components:y}}else if(a.type in o)c="tuple",u={components:o[a.type]};else if(mt.test(a.type))c=`${a.type}256`;else if(c=a.type,(t==null?void 0:t.type)!=="struct"&&!se(c))throw new qe({type:c});if(a.modifier){if(!((d=(f=t==null?void 0:t.modifiers)==null?void 0:f.has)!=null&&d.call(f,a.modifier)))throw new et({param:e,type:t==null?void 0:t.type,modifier:a.modifier});if(j.has(a.modifier)&&!wt(c,!!a.array))throw new tt({param:e,type:t==null?void 0:t.type,modifier:a.modifier})}const l={type:`${c}${a.array??""}`,...i,...s,...u};return k.set(n,l),l}function m(e,t=[],n="",r=0){const a=e.trim().length;for(let i=0;i<a;i++){const s=e[i],o=e.slice(i+1);switch(s){case",":return r===0?m(o,[...t,n.trim()]):m(o,t,`${n}${s}`,r);case"(":return m(o,t,`${n}${s}`,r+1);case")":return m(o,t,`${n}${s}`,r-1);default:return m(o,t,`${n}${s}`,r)}}if(n==="")return t;if(r!==0)throw new it({current:n,depth:r});return t.push(n.trim()),t}function se(e){return e==="address"||e==="bool"||e==="function"||e==="string"||J.test(e)||Y.test(e)}const gt=/^(?:after|alias|anonymous|apply|auto|byte|calldata|case|catch|constant|copyof|default|defined|error|event|external|false|final|function|immutable|implements|in|indexed|inline|internal|let|mapping|match|memory|mutable|null|of|override|partial|private|promise|public|pure|reference|relocatable|return|returns|sizeof|static|storage|struct|super|supports|switch|this|true|try|typedef|typeof|var|view|virtual)$/;function ht(e){return e==="address"||e==="bool"||e==="function"||e==="string"||e==="tuple"||J.test(e)||Y.test(e)||gt.test(e)}function wt(e,t){return t||e==="bytes"||e==="string"||e==="tuple"}function vt(e){const t={},n=e.length;for(let s=0;s<n;s++){const o=e[s];if(!ne(o))continue;const c=Ce(o);if(!c)throw new $({signature:o,type:"struct"});const u=c.properties.split(";"),l=[],f=u.length;for(let d=0;d<f;d++){const y=u[d].trim();if(!y)continue;const S=w(y,{type:"struct"});l.push(S)}if(!l.length)throw new at({signature:o});t[c.name]=l}const r={},a=Object.entries(t),i=a.length;for(let s=0;s<i;s++){const[o,c]=a[s];r[o]=ie(c,t)}return r}const $t=/^(?<type>[a-zA-Z$_][a-zA-Z0-9$_]*)(?<array>(?:\[\d*?\])+?)?$/;function ie(e,t,n=new Set){const r=[],a=e.length;for(let i=0;i<a;i++){const s=e[i];if(q.test(s.type))r.push(s);else{const c=g($t,s.type);if(!(c!=null&&c.type))throw new nt({abiParameter:s});const{array:u,type:l}=c;if(l in t){if(n.has(l))throw new st({type:l});r.push({...s,type:`tuple${u??""}`,components:ie(t[l]??[],t,new Set([...n,l]))})}else if(se(l))r.push(s);else throw new Ye({type:l})}}return r}function St(e){const t=vt(e),n=[],r=e.length;for(let a=0;a<r;a++){const i=e[a];ne(i)||n.push(ut(i,t))}return n}const xt="0x6492649264926492649264926492649264926492649264926492649264926492";function F({address:e,data:t,signature:n}){return Re([E([{type:"address"},{type:"bytes"},{type:"bytes"}],[e,t,n]),xt])}function At(e){for(const t of e)if(typeof t!="string")return!1;return!0}function Et(e){return At(e)?St(e):e}function B(e){let t=!0,n="",r=0,a="",i=!1;for(let s=0;s<e.length;s++){const o=e[s];if(["(",")",","].includes(o)&&(t=!0),o==="("&&r++,o===")"&&r--,!!t){if(r===0){if(o===" "&&["event","function","error",""].includes(a))a="";else if(a+=o,o===")"){i=!0;break}continue}if(o===" "){e[s-1]!==","&&n!==","&&n!==",("&&(n="",t=!1);continue}a+=o,n+=o}}if(!i)throw new I("Unable to normalize signature.");return a}function U(e,t){const n=typeof e,r=t.type;switch(r){case"address":return _(e,{strict:!1});case"bool":return n==="boolean";case"function":return n==="string";case"string":return n==="string";default:return r==="tuple"&&"components"in t?Object.values(t.components).every((a,i)=>U(Object.values(e)[i],a)):/^u?int(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/.test(r)?n==="number"||n==="bigint":/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/.test(r)?n==="string"||e instanceof Uint8Array:/[a-z]+[1-9]{0,3}(\[[0-9]{0,}\])+$/.test(r)?Array.isArray(e)&&e.every(a=>U(a,{...t,type:r.replace(/(\[[0-9]{0,}\])$/,"")})):!1}}function oe(e,t,n){for(const r in e){const a=e[r],i=t[r];if(a.type==="tuple"&&i.type==="tuple"&&"components"in a&&"components"in i)return oe(a.components,i.components,n[r]);const s=[a.type,i.type];if(s.includes("address")&&s.includes("bytes20")?!0:s.includes("address")&&s.includes("string")?_(n[r],{strict:!1}):s.includes("address")&&s.includes("bytes")?_(n[r],{strict:!1}):!1)return s}}function Mt(e,t,n){const{args:r=[],prepare:a=!0}=n??{},i=be(t,{strict:!1}),s=e.filter(u=>i?u.type==="function"||u.type==="error"?ue(u)===V(t,0,4):u.type==="event"?A(u)===t:!1:"name"in u&&u.name===t);if(s.length===0)throw new T({name:t});if(s.length===1)return{...s[0],...a?{hash:A(s[0])}:{}};let o;for(const u of s){if(!("inputs"in u))continue;if(!r||r.length===0){if(!u.inputs||u.inputs.length===0)return{...u,...a?{hash:A(u)}:{}};continue}if(!u.inputs||u.inputs.length===0||u.inputs.length!==r.length)continue;if(r.every((f,d)=>{const p="inputs"in u&&u.inputs[d];return p?U(f,p):!1})){if(o&&"inputs"in o&&o.inputs){const f=oe(u.inputs,o.inputs,r);if(f)throw new Pt({abiItem:u,type:f[0]},{abiItem:o,type:f[1]})}o=u}}const c=(()=>{if(o)return o;const[u,...l]=s;return{...u,overloads:l}})();if(!c)throw new T({name:t});return{...c,...a?{hash:A(c)}:{}}}function ue(e){return V(A(e),0,4)}function Tt(e){const t=typeof e=="string"?e:D(e);return B(t)}function A(e){return typeof e!="string"&&"hash"in e&&e.hash?e.hash:me(ge(Tt(e)))}class Pt extends I{constructor(t,n){super("Found ambiguous types in overloaded ABI Items.",{metaMessages:[`\`${t.type}\` in \`${B(D(t.abiItem))}\`, and`,`\`${n.type}\` in \`${B(D(n.abiItem))}\``,"","These types encode differently and cannot be distinguished at runtime.","Remove one of the ambiguous items in the ABI."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiItem.AmbiguityError"})}}class T extends I{constructor({name:t,data:n,type:r="item"}){const a=t?` with name "${t}"`:n?` with data "${n}"`:"";super(`ABI ${r}${a} not found.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiItem.NotFoundError"})}}function It(e,t){var a;const{bytecode:n,args:r}=t;return H(n,(a=e.inputs)!=null&&a.length&&(r!=null&&r.length)?L(e.inputs,r):"0x")}function kt(e){const t=e.find(n=>n.type==="constructor");if(!t)throw new T({name:"constructor"});return t}function _t(e,...t){const{overloads:n}=e,r=n?ce([e,...n],e.name,{args:t[0]}):e,a=Ot(r),i=t.length>0?L(r.inputs,t[0]):void 0;return i?H(a,i):a}function ce(e,t,n){const r=Mt(e,t,n);if(r.type!=="function")throw new T({name:t,type:"function"});return r}function Ot(e){return ue(e)}const Rt="0x6492649264926492649264926492649264926492649264926492649264926492",Dt="0x608060405234801561001057600080fd5b5060405161069438038061069483398101604081905261002f9161051e565b600061003c848484610048565b9050806000526001601ff35b60007f64926492649264926492649264926492649264926492649264926492649264926100748361040c565b036101e7576000606080848060200190518101906100929190610577565b60405192955090935091506000906001600160a01b038516906100b69085906105dd565b6000604051808303816000865af19150503d80600081146100f3576040519150601f19603f3d011682016040523d82523d6000602084013e6100f8565b606091505b50509050876001600160a01b03163b60000361016057806101605760405162461bcd60e51b815260206004820152601e60248201527f5369676e617475726556616c696461746f723a206465706c6f796d656e74000060448201526064015b60405180910390fd5b604051630b135d3f60e11b808252906001600160a01b038a1690631626ba7e90610190908b9087906004016105f9565b602060405180830381865afa1580156101ad573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906101d19190610633565b6001600160e01b03191614945050505050610405565b6001600160a01b0384163b1561027a57604051630b135d3f60e11b808252906001600160a01b03861690631626ba7e9061022790879087906004016105f9565b602060405180830381865afa158015610244573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906102689190610633565b6001600160e01b031916149050610405565b81516041146102df5760405162461bcd60e51b815260206004820152603a602482015260008051602061067483398151915260448201527f3a20696e76616c6964207369676e6174757265206c656e6774680000000000006064820152608401610157565b6102e7610425565b5060208201516040808401518451859392600091859190811061030c5761030c61065d565b016020015160f81c9050601b811480159061032b57508060ff16601c14155b1561038c5760405162461bcd60e51b815260206004820152603b602482015260008051602061067483398151915260448201527f3a20696e76616c6964207369676e617475726520762076616c756500000000006064820152608401610157565b60408051600081526020810180835289905260ff83169181019190915260608101849052608081018390526001600160a01b0389169060019060a0016020604051602081039080840390855afa1580156103ea573d6000803e3d6000fd5b505050602060405103516001600160a01b0316149450505050505b9392505050565b600060208251101561041d57600080fd5b508051015190565b60405180606001604052806003906020820280368337509192915050565b6001600160a01b038116811461045857600080fd5b50565b634e487b7160e01b600052604160045260246000fd5b60005b8381101561048c578181015183820152602001610474565b50506000910152565b600082601f8301126104a657600080fd5b81516001600160401b038111156104bf576104bf61045b565b604051601f8201601f19908116603f011681016001600160401b03811182821017156104ed576104ed61045b565b60405281815283820160200185101561050557600080fd5b610516826020830160208701610471565b949350505050565b60008060006060848603121561053357600080fd5b835161053e81610443565b6020850151604086015191945092506001600160401b0381111561056157600080fd5b61056d86828701610495565b9150509250925092565b60008060006060848603121561058c57600080fd5b835161059781610443565b60208501519093506001600160401b038111156105b357600080fd5b6105bf86828701610495565b604086015190935090506001600160401b0381111561056157600080fd5b600082516105ef818460208701610471565b9190910192915050565b828152604060208201526000825180604084015261061e816060850160208701610471565b601f01601f1916919091016060019392505050565b60006020828403121561064557600080fd5b81516001600160e01b03198116811461040557600080fd5b634e487b7160e01b600052603260045260246000fdfe5369676e617475726556616c696461746f72237265636f7665725369676e6572",jt=[{inputs:[{name:"_signer",type:"address"},{name:"_hash",type:"bytes32"},{name:"_signature",type:"bytes"}],stateMutability:"nonpayable",type:"constructor"},{inputs:[{name:"_signer",type:"address"},{name:"_hash",type:"bytes32"},{name:"_signature",type:"bytes"}],outputs:[{type:"bool"}],stateMutability:"nonpayable",type:"function",name:"isValidSig"}];function Bt(e){if(V(e,-32)!==Rt)throw new Vt(e)}function Ut(e){try{return Bt(e),!0}catch{return!1}}class Vt extends I{constructor(t){super(`Value \`${t}\` is an invalid ERC-6492 wrapped signature.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"WrappedSignature.InvalidWrappedSignatureError"})}}const zt="0x1626ba7e",Ft=[{type:"bytes32",name:"hash"},{type:"bytes",name:"signature"}],Zt=[{type:"bytes4"}];async function Ct(e){return O({contract:e.contract,method:[zt,Ft,Zt],params:[e.hash,e.signature]})}function Ht(e,t){const n={to:t};switch(n.to){case"number":return Kt(e,n);case"bigint":return Lt(e,n);case"boolean":return Nt(e,n);case"string":return Wt(e,n);default:return he(e,n)}}function Lt(e,t={}){return $e(e,t)}function Nt(e,t={}){return ve(e,t)}function Kt(e,t={}){return Se(e,t)}function Wt(e,t={}){return we(e,t)}const Gt="0xfB688330379976DA81eB64Fe4BF50d7401763B9C";async function le({hash:e,signature:t,address:n,client:r,chain:a,accountFactory:i}){const s=(()=>{if(xe(t))return t;if(typeof t=="object"&&"r"in t&&"s"in t)return Ae(t);if(t instanceof Uint8Array)return Ht(t,"hex");throw new Error(`Invalid signature type for signature ${t}: ${typeof t}`)})();if(await z(M({address:n,client:r,chain:a}))&&await P({hash:e,signature:s,contract:M({chain:a,address:n,client:r})}).catch(y=>(console.error("Error verifying EIP-1271 signature",y),!1)))return!0;const c=await(async()=>!i||Ut(s)?s:F({address:i.address,data:i.verificationCalldata,signature:s}))();let u;const l=await Ee(a),f=Et(jt);if(l)u={to:Gt,data:_t(ce(f,"isValidSig"),[n,e,c])};else{const p=kt(f);u={data:It(p,{args:[n,e,c],bytecode:Dt})}}const d=Me({chain:a,client:r});try{const p=await De(d,u);return Te(p)}catch{return!!await P({hash:e,signature:s,contract:M({chain:a,address:n,client:r})}).catch(y=>(console.error("Error verifying EIP-1271 signature",y),!1))}}const Jt="0x1626ba7e";async function P({hash:e,signature:t,contract:n}){try{return await Ct({hash:e,signature:t,contract:n})===Jt}catch(r){return console.error("Error verifying EIP-1271 signature",r),!1}}const Yt=`Ethereum Signed Message:
`;function qt(e,t){const n=typeof e=="string"?Z(e):e.raw instanceof Uint8Array?e.raw:Pe(e.raw),r=Z(`${Yt}${n.length}`);return h(N(r,n),t)}function Xt(e){const{domain:t={},message:n,primaryType:r}=e,a={EIP712Domain:Ie(t),...e.types};ke({domain:t,message:n,primaryType:r,types:a});const i=["0x1901"];if(t&&i.push(_e({domain:t,types:a})),r!=="EIP712Domain"){const s=(()=>{const o=fe({data:n,primaryType:r,types:a});return h(o)})();i.push(s)}return h(N(...i.map(s=>Oe(s))))}function fe({data:e,primaryType:t,types:n}){const r=[{type:"bytes32"}],a=[Qt({primaryType:t,types:n})];if(!n[t])throw new Error("Invalid types");for(const i of n[t]){const[s,o]=pe({types:n,name:i.name,type:i.type,value:e[i.name]});r.push(s),a.push(o)}return E(r,a)}function Qt({primaryType:e,types:t}){const n=K(en({primaryType:e,types:t}));return h(n)}function en({primaryType:e,types:t}){let n="";const r=de({primaryType:e,types:t});r.delete(e);const a=[e,...Array.from(r).sort()];for(const i of a){if(!t[i])throw new Error("Invalid types");n+=`${i}(${t[i].map(({name:s,type:o})=>`${o} ${s}`).join(",")})`}return n}function de({primaryType:e,types:t},n=new Set){const r=e.match(/^\w*/u),a=r==null?void 0:r[0];if(n.has(a)||t[a]===void 0)return n;n.add(a);for(const i of t[a])de({primaryType:i.type,types:t},n);return n}function pe({types:e,name:t,type:n,value:r}){if(e[n]!==void 0)return[{type:"bytes32"},h(fe({data:r,primaryType:n,types:e}))];if(n==="bytes")return r=`0x${(r.length%2?"0":"")+r.slice(2)}`,[{type:"bytes32"},h(r)];if(n==="string")return[{type:"bytes32"},h(K(r))];if(n.lastIndexOf("]")===n.length-1){const a=n.slice(0,n.lastIndexOf("[")),i=r.map(s=>pe({name:t,type:a,types:e,value:s}));return[{type:"bytes32"},h(E(i.map(([s])=>s),i.map(([,s])=>s)))]}return[{type:n},r]}async function fn({accountContract:e,factoryContract:t,options:n,message:r}){var c,u;const a=qt(r),i=await ye({factoryContract:t,accountContract:e,originalMsgHash:a});let s;if(i){const l=E([{type:"bytes32"}],[a]);s=await n.personalAccount.signTypedData({domain:{name:"Account",version:"1",chainId:n.chain.id,verifyingContract:e.address},primaryType:"AccountMessage",types:{AccountMessage:[{name:"message",type:"bytes"}]},message:{message:l}})}else s=await n.personalAccount.signMessage({message:r});if(await z(e)){if(await P({hash:a,signature:s,contract:e}))return s;throw new Error("Failed to verify signature")}else{const l=G({factoryContract:t,adminAddress:n.personalAccount.address,accountSalt:(c=n.overrides)==null?void 0:c.accountSalt,createAccountOverride:(u=n.overrides)==null?void 0:u.createAccount});if(!l)throw new Error("Create account override not provided");const f=await W(l),d=F({address:t.address,data:f,signature:s});if(await le({hash:a,signature:d,address:e.address,chain:e.chain,client:e.client}))return d;throw new Error("Unable to verify ERC-6492 signature after signing.")}}async function dn({accountContract:e,factoryContract:t,options:n,typedData:r}){var u,l,f,d,p;if(((l=(u=r.domain)==null?void 0:u.verifyingContract)==null?void 0:l.toLowerCase())===((f=e.address)==null?void 0:f.toLowerCase()))return n.personalAccount.signTypedData(r);const i=Xt(r),s=await ye({factoryContract:t,accountContract:e,originalMsgHash:i});let o;if(s){const y=E([{type:"bytes32"}],[i]);o=await n.personalAccount.signTypedData({domain:{name:"Account",version:"1",chainId:n.chain.id,verifyingContract:e.address},primaryType:"AccountMessage",types:{AccountMessage:[{name:"message",type:"bytes"}]},message:{message:y}})}else o=await n.personalAccount.signTypedData(r);if(await z(e)){if(await P({hash:i,signature:o,contract:e}))return o;throw new Error("Failed to verify signature")}else{const y=G({factoryContract:t,adminAddress:n.personalAccount.address,accountSalt:(d=n.overrides)==null?void 0:d.accountSalt,createAccountOverride:(p=n.overrides)==null?void 0:p.createAccount});if(!y)throw new Error("Create account override not provided");const S=await W(y),v=F({address:t.address,data:S,signature:o});if(await le({hash:i,signature:v,address:e.address,chain:e.chain,client:e.client}))return v;throw new Error("Unable to verify signature on smart account, please make sure the admin wallet has permissions and the signature is valid.")}}async function ye({factoryContract:e,accountContract:t,originalMsgHash:n}){try{const r=await O({contract:e,method:"function accountImplementation() public view returns (address)"});return await O({contract:M({address:r,chain:t.chain,client:t.client}),method:"function getMessageHash(bytes32 _hash) public view returns (bytes32)",params:[n]}).then(i=>i!=="0x").catch(()=>!1)}catch{return!1}}export{fn as smartAccountSignMessage,dn as smartAccountSignTypedData};
